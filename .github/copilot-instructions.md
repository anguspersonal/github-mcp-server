# GitHub MCP Server - Copilot Instructions

## Project Overview

This is the **GitHub MCP Server**, a Model Context Protocol (MCP) server that connects AI tools to GitHub's platform. It enables AI agents to manage repositories, issues, pull requests, workflows, and more through natural language.

**Key Details:**
- **Language:** Go 1.24+ (~38k lines of code)
- **Type:** MCP server application with CLI interface
- **Primary Package:** github-mcp-server (stdio MCP server - **this is the main focus**)
- **Secondary Package:** mcpcurl (testing utility - don't break it, but not the priority)
- **Framework:** Uses modelcontextprotocol/go-sdk for MCP protocol, google/go-github for GitHub API
- **Size:** ~60MB repository, 70 Go files
- **Library Usage:** This repository is also used as a library by the remote server. Functions that could be called by other repositories should be exported (capitalized), even if not required internally. Preserve existing export patterns.

**Code Quality Standards:**
- **Popular Open Source Repository** - High bar for code quality and clarity
- **Comprehension First** - Code must be clear to a wide audience
- **Clean Commits** - Atomic, focused changes with clear messages
- **Structure** - Always maintain or improve, never degrade
- **Code over Comments** - Prefer self-documenting code; comment only when necessary

## Critical Build & Validation Steps

### Required Commands (Run Before Committing)

**ALWAYS run these commands in this exact order before using report_progress or finishing work:**

1. **Format Code:** `script/lint` (runs `gofmt -s -w .` then `golangci-lint`)
2. **Run Tests:** `script/test` (runs `go test -race ./...`)
3. **Update Documentation:** `script/generate-docs` (if you modified MCP tools/toolsets)

**These commands are FAST:** Lint ~1s, Tests ~1s (cached), Build ~1s

### When Modifying MCP Tools/Endpoints

If you change any MCP tool definitions or schemas:
1. Run tests with `UPDATE_TOOLSNAPS=true go test ./...` to update toolsnaps
2. Commit the updated `.snap` files in `pkg/github/__toolsnaps__/`
3. Run `script/generate-docs` to update README.md
4. Toolsnaps document API surface and ensure changes are intentional

### Common Build Commands

```bash
# Download dependencies (rarely needed - usually cached)
go mod download
## Copilot / AI agent quick guide (condensed)

Purpose: help AI coding agents be productive quickly — architecture, key files, commands, and repo-specific rules.

What this repo is: a Go (1.24+) MCP server that exposes GitHub tools via the modelcontextprotocol. Primary binary: `cmd/github-mcp-server` (stdio transport). Secondary: `cmd/mcpcurl` (testing client).

High-level architecture:
- `cmd/github-mcp-server/` — CLI entry (cobra + viper). Run `./github-mcp-server stdio` locally.
- `pkg/github/` — MCP tool implementations and schemas. Tool snapshots live in `pkg/github/__toolsnaps__/`.
- `internal/ghmcp/` — core server wiring and runtime helpers.
- `internal/githubv4mock/` — GraphQL mocks used by tests.

Immediate useful commands (run before committing):
```powershell
.
script/lint        # gofmt -s -w . && golangci-lint
script/test        # go test -race ./...
script/generate-docs  # update README tool docs when changing tools
```

Tooling & CI notes:
- Tool schemas: when changing tools set `UPDATE_TOOLSNAPS=true go test ./...` to regenerate snapshots in `pkg/github/__toolsnaps__/` and commit them.
- CI requires `script/generate-docs` to keep autogenerated README in sync (docs-check will fail otherwise).
- E2E tests require a PAT: use `GITHUB_MCP_SERVER_E2E_TOKEN` and optionally `GITHUB_MCP_SERVER_E2E_DEBUG=true` for in-process runs.

Conventions you must follow here:
- Export functions that could be used by external callers (capitalize). This repo is consumed as a library by other servers.
- Naming: use acronyms as `ID`, `API`, `URL`, `HTTP` (e.g., `userID`, `HTTPClient`).
- Tests: use `testify` (`require` for hard assertions). Keep tests next to implementation files.

Files & patterns to inspect when adding features:
- add MCP tools in `pkg/github/` (follow existing `*_tools.go` patterns and tests).
- register toolsets in `pkg/toolsets/` or `pkg/github/dynamic_tools.go` as appropriate.
- update snapshots under `pkg/github/__toolsnaps__/` when schema changes.

Quick PR checklist for changes that touch tools:
1. Add/update code in `pkg/github/`.
2. Add/adjust unit tests (use mocks from `internal/githubv4mock` or go-github-mock).
3. Run `UPDATE_TOOLSNAPS=true go test ./...` and commit `.snap` files.
4. Run `script/generate-docs`, then `script/lint` and `script/test`.

If something is unclear or you want an extended section (deep-dive into tool snapshot format, example tool implementation, or test patterns), tell me which area and I will expand this file.

Key files to open first: `cmd/github-mcp-server/main.go`, `pkg/github/instructions.go`, `pkg/github/__toolsnaps__/`, `internal/ghmcp/server.go`.

Note: I kept the original longer document in the repo history — this condensed version focuses on practical, actionable items for an AI agent.
